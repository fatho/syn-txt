<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <title>syn.txt</title>
    <script src="monaco-editor/min/vs/loader.js"></script>
    <script>
        require.config({ paths: { 'vs': 'monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            var containerElem = document.getElementById('container');

            monaco.languages.register({ id: 'syntxt' });
            monaco.languages.setMonarchTokensProvider('syntxt', {
                // Set defaultToken to invalid to see what you do not tokenize yet
                defaultToken: 'invalid',

                keywords: [
                    'true', 'false', 'not', 'and', 'or'
                ],

                typeKeywords: [],

                operators: [
                    '+', '-', '*', '/'
                ],

                // we include these common regular expressions
                symbols: /[=><!~?:&|+\-*\/\^%]+/,

                // C# style strings
                escapes: /\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,

                // The main tokenizer for our languages
                tokenizer: {
                    root: [
                        // identifiers and keywords
                        [/[a-z_$][a-zA-Z0-9_$]*/,
                            {
                                cases:
                                {
                                    '@typeKeywords': 'keyword',
                                    '@keywords': 'keyword',
                                    '@default': 'identifier'
                                }
                            }
                        ],
                        [/[A-Z][\w\$]*/, 'type.identifier'],  // to show class names nicely

                        // whitespace
                        { include: '@whitespace' },

                        // delimiters and operators
                        [/[{}()\[\]]/, '@brackets'],
                        [/[<>](?!@symbols)/, '@brackets'],
                        [/@symbols/, {
                            cases: {
                                '@operators': 'operator',
                                '@default': ''
                            }
                        }],

                        // numbers
                        [/\d(:?[\d_])*\/\d(:?[\d_])*/, 'number.float'],
                        [/\d(:?[\d_])*\.\d(:?[\d_])*/, 'number.float'],
                        [/\d(:?[\d_])*/, 'number'],

                        // delimiter: after number because of .\d floats
                        [/[;,.]/, 'delimiter'],

                        // strings
                        [/"([^"\\]|\\.)*$/, 'string.invalid'],  // non-teminated string
                        [/"/, { token: 'string.quote', bracket: '@open', next: '@string' }],
                    ],

                    string: [
                        [/[^\\"]+/, 'string'],
                        [/@escapes/, 'string.escape'],
                        [/\\./, 'string.escape.invalid'],
                        [/"/, { token: 'string.quote', bracket: '@close', next: '@pop' }]
                    ],

                    whitespace: [
                        [/[ \t\r\n]+/, 'white'],
                        [/\/\/.*$/, 'comment'],
                    ],
                },
            });

            var editor = monaco.editor.create(containerElem, {
                value: [
                    'Song {',
                    '    bpm: 120',
                    '    sampleRate: 44_100',
                    '    meta: Meta {',
                    '        name: "Example Song"',
                    '        author: "John Doe"',
                    '        year: 2021',
                    '        description: "Simply.\\nAwesome."',
                    '        awesome: true and not false',
                    '    }',
                    '    Track {',
                    '      name: "Lead"',
                    '      filtes: [',
                    '        LowPass {',
                    '          cutoff: time * 100.1',
                    '        }',
                    '      ]',
                    '',
                    '      Sequence {',
                    '        start: 8/4',
                    '      }',
                    '    }',
                    '    // Test for comments',
                    '    Track {',
                    '      name: "Drums"',
                    '    }',
                    '}',
                ].join('\n'),
                language: 'syntxt',
            });

            // Resize the editor when element size changes
            const resizeObserver = new ResizeObserver(entries => {
                editor.layout();
            });
            resizeObserver.observe(containerElem);
        });
    </script>

    <style type="text/css">
        * {
            margin: 0;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
            background-color: #1b1b1b;
            color: white;
            font-family: 'Roboto', sans-serif;
        }

        .root {
            height: 100vh;
        }

        .header {
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 48px;
            width: 100%;
        }

        .footer {
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 24px;
            width: 100%;
        }

        .fill {
            height: calc(100vh - 24px - 48px);
        }
    </style>
</head>

<body>
    <div class="root" id="root">
        <div class="header">
            <img src="logo.png" height="40px" />
            <span style="font-size: 20pt;">syn.txt editor</span>
        </div>
        <div class="fill" id="container"></div>
        <div class="footer">
            TODO: some useful information in the footer
        </div>
    </div>
</body>

</html>
